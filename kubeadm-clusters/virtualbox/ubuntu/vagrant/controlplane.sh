
###################################################
sudo kubeadm config images pull >/dev/null
#################################################

##################################################
# kubelet requires swap off
sudo -i
swapoff -a
exit
##############################################

##########################################################
# keep swap off after reboot
sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab
###################################################

#################################################################################################################
sudo kubeadm init --apiserver-advertise-address=192.168.56.102 --pod-network-cidr=172.16.0.0/16
#################################################################################################################

#########################################################################
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
##################################################################

###############################################################
export KUBECONFIG=/etc/kubernetes/admin.conf
##################################################################

##################################################################
sudo stat -c %a /etc/kubernetes/admin.conf
##################################################################

################################################
sudo chmod 644 /etc/kubernetes/admin.conf
################################################

#####################################################################################################################################
# install Calico pod network addon
kubectl --kubeconfig=/etc/kubernetes/admin.conf create -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/tigera-operator.yaml >/dev/null
#####################################################################################################################################

##############################################################################################################################################
kubectl --kubeconfig=/etc/kubernetes/admin.conf create -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/custom-resources.yaml >/dev/null
#####################################################################################################################################

sudo systemctl status kubelet
sudo systemctl status kubelet.service